<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Калкулатор € / лв /title>

  <style>
    :root { font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif; }
    body { margin:0; background:#f6f7fb; color:#111; }
    .wrap { max-width: 860px; margin: 24px auto; padding: 16px; }
    .card { background:#fff; border:1px solid #e7e8ef; border-radius:14px; padding:18px; box-shadow:0 2px 10px rgba(0,0,0,.04); }
    h1 { font-size: 20px; margin: 0 0 10px; }
    .rate { display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin: 8px 0 16px; }
    .rate code { background:#f1f2f7; padding:6px 10px; border-radius:10px; }
    .pill { display:inline-block; padding:3px 8px; border-radius:999px; background:#0b1020; color:#fff; font-size:12px; }

    .grid { display:grid; grid-template-columns: 1fr 1fr; gap: 12px; }
    @media (max-width: 720px){ .grid{ grid-template-columns:1fr; } }

    label { display:block; font-size:12px; opacity:.85; margin:0 0 6px; }

    input, select, button {
      width:100%; padding:12px; border-radius:12px;
      border:1px solid #d6d8e3; font-size:14px; background:#fff;
      box-sizing:border-box;
    }
    input:focus, select:focus { outline:2px solid #cfd6ff; border-color:#95a3ff; }

    .actions { display:flex; gap:10px; margin-top:12px; flex-wrap:wrap; }
    button { cursor:pointer; border:0; }
    .btn-primary { background:#2f57ff; color:#fff; }
    .btn-secondary { background:#eef0ff; color:#1c2b8a; }

    .out { margin-top:14px; padding:14px; border-radius:14px; background:#0b1020; color:#fff; display:none; }
    .out h2 { margin:0 0 8px; font-size:16px; }

    .row {
      display:flex; justify-content:space-between; gap:10px;
      padding:6px 0; border-bottom:1px solid rgba(255,255,255,.12);
    }
    .row:last-child { border-bottom:0; }

    .warn {
      margin-top:10px; padding:10px 12px; border-radius:12px;
      background:#fff3cd; border:1px solid #ffe08a; color:#5a4600;
    }
    .ok {
      margin-top:10px; padding:10px 12px; border-radius:12px;
      background:#d1e7dd; border:1px solid #a3cfbb; color:#0a3d2a;
    }
    .tiny { font-size:12px; opacity:.85; margin-top:10px; line-height:1.35; }
  </style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>Плащане в евро и/или лев</h1>

    <div class="rate">
      <span class="pill">Курс</span>
      <code>1 € = 1.95583 лв</code>
      <span class="pill">2 знака</span>
    </div>

    <div class="grid">
      <div>
        <label for="priceEur">Сума на сметката (в €)</label>
        <input id="priceEur" type="text" placeholder="напр. 12,30 или 12.30">
      </div>

      <div>
        <label for="showBoth">Покажи еквивалент в лв</label>
        <select id="showBoth">
          <option value="yes" selected>Да</option>
          <option value="no">Не</option>
        </select>
      </div>

      <div>
        <label for="paidEur">Платено в €</label>
        <input id="paidEur" type="text" placeholder="напр. 10,00">
      </div>

      <div>
        <label for="paidBgn">Платено в лв</label>
        <input id="paidBgn" type="text" placeholder="напр. 20,00">
      </div>
    </div>

    <div class="actions">
      <button class="btn-primary" id="calcBtn">Изчисли</button>
      <button class="btn-secondary" id="resetBtn">Нулирай</button>
    </div>

    <div id="msg"></div>

    <div class="out" id="out">
      <h2>Резултат</h2>
      <div class="row"><div>Сметка</div><div id="oPrice"></div></div>
      <div class="row"><div>Платено общо</div><div id="oPaid"></div></div>
      <div class="row"><div>Ресто (в €)</div><div id="oChange"></div></div>
      <div id="bothBlock" style="margin-top:10px;"></div>
    </div>

    <div class="tiny">
      Може да пишете <b>запетая</b> или <b>точка</b>. Форматирането става автоматично.
    </div>
  </div>
</div>

<script>
/* ================= НАСТРОЙКА ================= */
const RATE = 1.95583;
const DECIMAL = ","; // ← смени на "." ако искаш точка
/* ============================================ */

const $ = (id) => document.getElementById(id);

/* приема и , и . и маха интервали */
function parseMoney(raw){
  if (!raw) return 0;
  let s = String(raw).trim().replace(/\s|\u00A0/g,"");
  s = s.replace(/[^\d,.\-]/g,"");

  const lc = s.lastIndexOf(",");
  const ld = s.lastIndexOf(".");
  if (lc !== -1 && ld !== -1){
    const p = Math.max(lc, ld);
    const dec = s.length - p - 1;
    s = s.replace(/[.,]/g,"");
    if (dec > 0){
      s = s.slice(0, s.length-dec) + "." + s.slice(s.length-dec);
    }
  } else if (lc !== -1){
    s = s.replace(/\./g,"").replace(",",".");
  } else if (ld !== -1){
    s = s.replace(/,/g,"");
  }

  const n = Number(s);
  return Number.isFinite(n) ? n : 0;
}

function round2(x){
  return Math.round((x + Number.EPSILON) * 100) / 100;
}

function formatInput(val){
  const n = parseMoney(val);
  if (!Number.isFinite(n)) return "";
  let [i,f] = n.toFixed(2).split(".");
  i = i.replace(/\B(?=(\d{3})+(?!\d))/g," ");
  return DECIMAL === "," ? `${i},${f}` : `${i}.${f}`;
}

function eurToBgn(e){ return e * RATE; }
function bgnToEur(b){ return b / RATE; }

function fmt(n, cur){
  return `${n.toFixed(2)} ${cur === "EUR" ? "€" : "лв"}`;
}

function calc(){
  const priceEur = parseMoney($("priceEur").value);
  const paidEur  = parseMoney($("paidEur").value);
  const paidBgn  = parseMoney($("paidBgn").value);
  const showBoth = $("showBoth").value === "yes";

  $("msg").innerHTML = "";
  $("out").style.display = "none";
  $("bothBlock").innerHTML = "";

  if (priceEur <= 0){
    $("msg").innerHTML = `<div class="warn">Въведи сума на сметката.</div>`;
    return;
  }

  const totalPaidEur = paidEur + bgnToEur(paidBgn);
  const diff = totalPaidEur - priceEur;

  if (diff < -1e-9){
    $("msg").innerHTML =
      `<div class="warn">Не достигат ${fmt(round2(-diff),"EUR")}</div>`;
  } else {
    $("msg").innerHTML = `<div class="ok">Плащането е достатъчно</div>`;
  }

  $("oPrice").textContent  = fmt(round2(priceEur),"EUR");
  $("oPaid").textContent   = fmt(round2(totalPaidEur),"EUR");
  $("oChange").textContent = fmt(round2(Math.max(diff,0)),"EUR");

  if (showBoth){
    $("bothBlock").innerHTML = `
      <div class="row"><div>Сметка (лв)</div><div>${fmt(round2(eurToBgn(priceEur)),"BGN")}</div></div>
      <div class="row"><div>Платено (лв)</div><div>${fmt(round2(eurToBgn(totalPaidEur)),"BGN")}</div></div>
      <div class="row"><div>Ресто (лв)</div><div>${fmt(round2(eurToBgn(Math.max(diff,0))),"BGN")}</div></div>
      <div class="row"><div>Разбивка</div><div>${fmt(round2(paidEur),"EUR")} + ${fmt(round2(paidBgn),"BGN")}</div></div>
    `;
  }

  $("out").style.display = "block";
}

function resetAll(){
  ["priceEur","paidEur","paidBgn"].forEach(id => $(id).value="");
  $("msg").innerHTML = "";
  $("out").style.display = "none";
}

["priceEur","paidEur","paidBgn"].forEach(id => {
  const el = $(id);
  el.addEventListener("blur", () => {
    if (el.value.trim()) el.value = formatInput(el.value);
  });
  el.addEventListener("keydown", e => {
    if (e.key === "Enter") calc();
  });
});

$("calcBtn").addEventListener("click", calc);
$("resetBtn").addEventListener("click", resetAll);
</script>
</body>
</html>
